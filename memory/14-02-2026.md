# Session Summary - 14-02-2026

**Focus:** FLOW dashboard bug fix  
**Outcome:** Fixed message duplication bug

---

## Accomplishments

### ✅ Fixed Message Duplication Bug
**Problem:** Messages were appearing twice in FLOW dashboard chat

**What I tried that FAILED:**
1. Added duplicate detection using `data-message-id` attributes — didn't work because SSE appending happened before the ID check
2. Tried removing polling entirely and relying only on SSE — worked for duplicates but SSE reconnects were flaky, missed messages during reconnect
3. Added a dedupe Set to track recently seen message IDs — race condition still caused flashes of duplicates before dedupe caught them
4. Tried debouncing the render — added latency, still saw duplicates

**Root cause:** SSE handler was directly appending messages to DOM (`chatMessages.appendChild()`), while polling also fetched and re-rendered all messages via `renderMessages()`. When both fired near-simultaneously, duplicates appeared.

**Fix:** Changed SSE `onmessage` handler to call `loadChat()` instead of direct DOM manipulation. This ensures single source of truth (server) and prevents race condition duplicates. SSE provides the "wake up" signal, polling keeps it synced.

**File:** `app/dashboard.html` (line ~3763)

**Before:**
```javascript
eventSource.onmessage = (event) => {
    const message = JSON.parse(event.data);
    // Skip connection message
    if (message.type === 'connected') return;
    
    // Add message to chat immediately - BUG: duplicates with polling
    const messageDiv = document.createElement('div');
    // ... build message HTML ...
    chatMessages.appendChild(messageDiv);
}
```

**After:**
```javascript
eventSource.onmessage = (event) => {
    const message = JSON.parse(event.data);
    if (message.type === 'connected') return;
    
    // Refresh from server - polling keeps it synced, no duplicates
    loadChat();
}
```

**Committed:** `c2b990c`

---

## Current State
- FLOW dashboard messages should no longer duplicate
- SSE still provides fast updates (~500ms vs 3s polling)
- Polling continues as fallback/sync mechanism

---

## Next Steps
1. Test the fix in browser
2. Continue with UI polish tasks (see pending-tasks.md)

---

*Session ended 00:15*
